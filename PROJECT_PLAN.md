# 랜덤 런치 매칭 웹앱 - 프로젝트 계획서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**점심 룰렛 (Lunch Roulette)** - 수치예보센터 크로스과 소통 활성화 웹앱

### 1.2 목적
- 3개 과(수치예보기획과, 수치예보기술과, 수치예보활용팀) 간 자연스러운 교류 촉진
- 점심시간을 활용한 부담 없는 소통 기회 제공
- 즉각적인 피드백과 시각화로 참여 동기 부여

### 1.3 대상
- 수치예보센터 전 직원 약 100명

### 1.4 핵심 차별점 (작년 실패 교훈 반영)
| 작년 문제점 | 이번 해결책 |
|------------|------------|
| 센터장 동행 부담 | 동료 간 자유로운 매칭 |
| 수목원 산책 시간 소요 | 구내식당에서 바로 인증 |
| 연말 시상 (보상이 멀음) | 실시간 통계 + 월간 보상 |
| 일부만 참여 | 랜덤 매칭으로 새로운 만남 유도 |

---

## 2. 기능 명세

### 2.1 사용자 역할 정의

| 역할 | 권한 |
|------|------|
| 일반 사용자 | 매칭 신청, 점심 인증, 본인 통계 조회 |
| 관리자 | 직원 관리, 매칭 실행, 전체 통계 조회, 시스템 설정 |

### 2.2 사용자 기능 상세

#### A. 매칭 신청
- 당일 점심 매칭 신청 (오전 11시까지)
- 신청 취소 가능
- 신청 현황 실시간 확인

#### B. 매칭 결과 확인
- 11시 자동 매칭 또는 관리자 수동 매칭
- 3~4명 그룹으로 랜덤 배정
- **타과 인원 최소 1명 보장** 알고리즘

#### C. 점심 인증
- 함께 식사한 사람 선택 (복수 선택)
- 한줄평 작성 (선택)
- 사진 업로드 (선택)
- 상호 인증 시 포인트 부여

#### D. 개인 통계
- 총 참여 횟수
- 만난 고유 인원 수
- 타과 교류 비율
- 월별 참여 추이 그래프

### 2.3 관리자 기능 상세

#### A. 직원 관리
- 직원 목록 조회 (과별 필터)
- 직원 추가 (이름, 소속과, 이메일/사번)
- 직원 정보 수정
- 직원 삭제 (비활성화)
- CSV 일괄 등록

#### B. 매칭 관리
- 수동 매칭 실행
- 매칭 결과 미리보기
- 매칭 결과 확정/재배정
- 미매칭 인원 처리

#### C. 통계 대시보드

| 통계 유형 | 항목 |
|----------|------|
| 일별 | 참여자 수, 그룹 수, 인증 완료율 |
| 월별 | 참여자 추이, 과별 참여율, 신규 연결 수 |
| 연별 | 총 참여 횟수, 네트워크 밀도, MVP 선정 |

#### D. 시스템 설정
- 매칭 마감 시간 설정
- 그룹 인원 수 설정 (3~4명)
- 포인트 규칙 설정

---

## 3. 데이터 모델

### 3.1 엔티티 정의 (Supabase PostgreSQL)

```
┌─────────────────────────────────────────────────────────────┐
│                        profiles                              │
│              (Supabase Auth 연동 사용자 프로필)              │
├─────────────────────────────────────────────────────────────┤
│ id (PK, FK → auth.users.id)                                  │
│ name: string                                                 │
│ department: enum ['기획과', '기술과', '활용팀']              │
│ employee_number: string (사번, optional)                     │
│ is_active: boolean (default: true)                           │
│ is_admin: boolean (default: false)                           │
│ total_points: integer (default: 0)                           │
│ created_at: timestamptz                                      │
│ updated_at: timestamptz                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                     match_requests                           │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ user_id (FK → profiles.id)                                   │
│ request_date: date                                           │
│ status: enum ['pending', 'matched', 'cancelled']             │
│ created_at: timestamptz                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      match_groups                            │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ match_date: date                                             │
│ group_number: integer                                        │
│ created_at: timestamptz                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    match_group_members                       │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ group_id (FK → match_groups.id)                              │
│ user_id (FK → profiles.id)                                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      lunch_records                           │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ recorder_id (FK → profiles.id)                               │
│ group_id (FK → match_groups.id, optional)                    │
│ record_date: date                                            │
│ comment: text (optional)                                     │
│ photo_url: string (optional, Supabase Storage URL)           │
│ created_at: timestamptz                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    lunch_participants                        │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ record_id (FK → lunch_records.id)                            │
│ participant_id (FK → profiles.id)                            │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                     point_history                            │
│                    (포인트 적립 이력)                        │
├─────────────────────────────────────────────────────────────┤
│ id (PK, uuid)                                                │
│ user_id (FK → profiles.id)                                   │
│ points: integer                                              │
│ reason: enum ['match_request', 'lunch_verified',             │
│               'cross_dept', 'first_meet', 'comment', 'photo']│
│ reference_id: uuid (optional, 관련 record id)                │
│ created_at: timestamptz                                      │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 관계도

```
auth.users (Supabase 내장)
     │
     ▼
profiles ──────┬───── match_requests
               │
               ├───── match_group_members ───── match_groups
               │                                     │
               ├───── lunch_records ─────────────────┘
               │           │
               │           └───── lunch_participants
               │
               └───── point_history
```

### 3.3 Row Level Security (RLS) 정책

| 테이블 | SELECT | INSERT | UPDATE | DELETE |
|--------|--------|--------|--------|--------|
| profiles | 모든 사용자 | 본인만 | 본인만 | 관리자만 |
| match_requests | 모든 사용자 | 본인만 | 본인만 | 본인만 |
| match_groups | 모든 사용자 | 관리자만 | 관리자만 | 관리자만 |
| lunch_records | 모든 사용자 | 본인만 | 본인만 | 본인만 |
| point_history | 본인만 | 시스템만 | - | - |

---

## 4. 화면 설계

### 4.1 화면 목록

| 화면 ID | 화면명 | 설명 |
|---------|--------|------|
| U-01 | 로그인 | 이름/사번으로 간편 로그인 |
| U-02 | 메인 대시보드 | 오늘의 매칭, 내 통계 요약 |
| U-03 | 매칭 신청 | 오늘 점심 매칭 신청/취소 |
| U-04 | 매칭 결과 | 내가 속한 그룹 확인 |
| U-05 | 점심 인증 | 함께한 사람 선택, 한줄평 작성 |
| U-06 | 내 통계 | 개인 참여 이력, 만난 사람 목록 |
| U-07 | 전체 랭킹 | 참여 랭킹, 네트워크 시각화 |
| A-01 | 관리자 대시보드 | 오늘 현황, 주요 통계 |
| A-02 | 직원 관리 | 직원 CRUD |
| A-03 | 매칭 관리 | 매칭 실행, 결과 관리 |
| A-04 | 통계 조회 | 일별/월별/연별 통계 |

### 4.2 화면 흐름도

```
[로그인 U-01]
     │
     ▼
[메인 대시보드 U-02] ◄──────────────────────────┐
     │                                           │
     ├──► [매칭 신청 U-03] ──► [매칭 결과 U-04]  │
     │                              │            │
     │                              ▼            │
     │                    [점심 인증 U-05] ──────┘
     │
     ├──► [내 통계 U-06]
     │
     └──► [전체 랭킹 U-07]

[관리자 전용]
[관리자 대시보드 A-01]
     │
     ├──► [직원 관리 A-02]
     ├──► [매칭 관리 A-03]
     └──► [통계 조회 A-04]
```

---

## 5. 기술 스택

### 5.1 프론트엔드
- **React 18** (함수형 컴포넌트 + Hooks)
- **Tailwind CSS** (스타일링)
- **Recharts** (차트/그래프)
- **React Router** (SPA 라우팅)

### 5.2 백엔드/데이터베이스 (Supabase)
- **PostgreSQL**: 관계형 데이터베이스
- **Supabase Auth**: 사용자 인증 (이메일 매직링크 또는 비밀번호)
- **Supabase Realtime**: 실시간 데이터 동기화 (매칭 결과, 신청 현황 즉시 반영)
- **Supabase Storage**: 점심 인증 사진 저장
- **Row Level Security (RLS)**: 데이터 접근 권한 관리
- **Edge Functions**: 11시 자동 매칭 스케줄러 (선택)

### 5.3 Supabase 선택 이유
| 장점 | 설명 |
|------|------|
| 무료 티어 충분 | 500MB DB, 1GB Storage, 100명 규모에 적합 |
| 빠른 구축 | REST API 자동 생성, 별도 서버 개발 불필요 |
| 실시간 기능 | 매칭 결과, 신청 현황 실시간 반영 |
| 인증 내장 | 별도 인증 시스템 구축 불필요 |
| PostgreSQL 기반 | 설계한 데이터 모델 그대로 사용 가능 |

### 5.4 주요 라이브러리
- **@supabase/supabase-js** (Supabase 클라이언트)
- **date-fns** (날짜 처리)
- **lucide-react** (아이콘)

---

## 6. 매칭 알고리즘

### 6.1 기본 규칙
1. 그룹당 3~4명
2. 각 그룹에 **최소 2개 과** 인원 포함
3. 가능하면 이전에 안 만난 조합 우선

### 6.2 알고리즘 흐름

```
1. 신청자 목록을 과별로 분류
   - 기획과: [A, B, C, ...]
   - 기술과: [D, E, F, ...]
   - 활용팀: [G, H, I, ...]

2. 각 과 목록을 랜덤 셔플

3. 그룹 생성 (Round-Robin 방식)
   - 그룹1: 기획과1명 + 기술과1명 + 활용팀1명
   - 그룹2: 기획과1명 + 기술과1명 + 활용팀1명
   - ...

4. 남은 인원 배분
   - 3명 미만 그룹에 우선 배정
   - 단독 잔여 인원은 기존 그룹에 추가 (최대 4명)

5. 예외 처리
   - 한 과만 신청자 있을 경우: 같은 과 내 매칭 허용
   - 2명만 신청: 2인 그룹 허용
```

### 6.3 타과 교류 최적화

```
우선순위:
1. 3개 과 모두 포함 (최우선)
2. 2개 과 포함
3. 같은 과 (불가피할 때만)
```

---

## 7. 포인트/보상 체계

### 7.1 포인트 규칙

| 활동 | 포인트 |
|------|--------|
| 매칭 신청 | +1 |
| 점심 인증 완료 | +3 |
| 타과 인원과 식사 | +2 (인당) |
| 처음 만나는 사람과 식사 | +3 (인당) |
| 한줄평 작성 | +1 |
| 사진 업로드 | +1 |

### 7.2 월간 보상 제안

| 순위 | 보상 |
|------|------|
| 1위 | 커피 쿠폰 5매 |
| 2~3위 | 커피 쿠폰 3매 |
| 4~10위 | 커피 쿠폰 1매 |
| 랜덤 추첨 | 참여자 중 5명 커피 쿠폰 |

---

## 8. 개발 일정

### Phase 1: 환경 설정 및 인증
- [ ] React + Vite 프로젝트 셋업
- [ ] Supabase 프로젝트 생성 및 연동
- [ ] DB 테이블 생성 (마이그레이션 SQL 실행)
- [ ] RLS 정책 설정
- [ ] Supabase Auth 로그인/회원가입 구현
- [ ] 프로필 등록 화면

### Phase 2: 핵심 기능
- [ ] 매칭 신청/취소 (Realtime 연동)
- [ ] 매칭 알고리즘 구현
- [ ] 매칭 결과 표시 (Realtime 연동)
- [ ] 점심 인증 기능
- [ ] 사진 업로드 (Supabase Storage)

### Phase 3: 관리자 기능
- [ ] 직원 관리 (CRUD)
- [ ] 매칭 수동 실행
- [ ] CSV 업로드

### Phase 4: 통계/시각화
- [ ] 개인 통계 화면
- [ ] 포인트 시스템 구현
- [ ] 일별/월별/연별 통계
- [ ] 차트 구현
- [ ] 랭킹 화면

### Phase 5: 마무리
- [ ] UI 다듬기
- [ ] 테스트 데이터 생성
- [ ] 버그 수정
- [ ] 배포 (Vercel/Netlify)

---

## 9. 파일 구조

```
/lunch-roulette
├── /src
│   ├── /components
│   │   ├── /common          # 공통 컴포넌트
│   │   │   ├── Header.jsx
│   │   │   ├── Navigation.jsx
│   │   │   ├── Card.jsx
│   │   │   ├── Button.jsx
│   │   │   └── LoadingSpinner.jsx
│   │   ├── /auth            # 인증 관련 컴포넌트
│   │   │   ├── LoginForm.jsx
│   │   │   ├── SignUpForm.jsx
│   │   │   └── ProtectedRoute.jsx
│   │   ├── /user            # 사용자 화면 컴포넌트
│   │   │   ├── Dashboard.jsx
│   │   │   ├── MatchRequest.jsx
│   │   │   ├── MatchResult.jsx
│   │   │   ├── LunchRecord.jsx
│   │   │   └── MyStats.jsx
│   │   ├── /admin           # 관리자 화면 컴포넌트
│   │   │   ├── AdminDashboard.jsx
│   │   │   ├── EmployeeManagement.jsx
│   │   │   ├── MatchManagement.jsx
│   │   │   └── Statistics.jsx
│   │   └── /charts          # 차트 컴포넌트
│   │       ├── DailyChart.jsx
│   │       ├── MonthlyChart.jsx
│   │       └── NetworkGraph.jsx
│   ├── /hooks               # 커스텀 훅
│   │   ├── useAuth.js       # Supabase 인증 훅
│   │   ├── useProfile.js    # 사용자 프로필 훅
│   │   ├── useMatching.js   # 매칭 관련 훅
│   │   └── useRealtime.js   # Supabase Realtime 훅
│   ├── /lib                 # 외부 서비스 설정
│   │   └── supabase.js      # Supabase 클라이언트 초기화
│   ├── /services            # API 서비스 레이어
│   │   ├── authService.js
│   │   ├── profileService.js
│   │   ├── matchService.js
│   │   ├── lunchService.js
│   │   ├── pointService.js
│   │   └── storageService.js
│   ├── /utils               # 유틸리티
│   │   ├── matchingAlgorithm.js
│   │   ├── statistics.js
│   │   └── dateUtils.js
│   ├── /constants           # 상수
│   │   └── index.js
│   ├── App.jsx
│   └── main.jsx
├── /supabase                # Supabase 로컬 설정 (선택)
│   └── /migrations          # DB 마이그레이션 SQL
│       ├── 001_create_profiles.sql
│       ├── 002_create_match_tables.sql
│       ├── 003_create_lunch_tables.sql
│       ├── 004_create_point_history.sql
│       └── 005_create_rls_policies.sql
├── .env.local               # 환경변수 (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY)
├── package.json
└── README.md
```

---

## 10. 위험 요소 및 대응

| 위험 | 영향 | 대응 방안 |
|------|------|----------|
| 참여율 저조 | 높음 | 초기 목표를 30%로 설정, 점진적 확대 |
| 같은 사람만 반복 매칭 | 중간 | "처음 만남" 보너스 포인트로 유도 |
| 인증 누락 | 중간 | 당일 오후 알림, 다음날까지 인증 허용 |
| 한 과만 신청 | 낮음 | 같은 과 내 매칭 허용 (차선책) |
| Supabase 무료 한도 초과 | 낮음 | 100명 규모에서는 충분, 모니터링 후 유료 전환 검토 |
| 네트워크 오류 | 중간 | 오프라인 상태 감지 및 재시도 로직 구현 |

---

## 11. 성공 지표 (KPI)

### 단기 (1개월)
- 주간 평균 참여자 30명 이상
- 인증 완료율 70% 이상

### 중기 (3개월)
- 전체 직원의 50% 이상 1회 이상 참여
- 과 간 교류 비율 60% 이상

### 장기 (1년)
- 전체 직원의 80% 이상 참여 경험
- 평균 "만난 고유 인원 수" 20명 이상

---

## 12. 향후 확장 가능성

1. **Edge Functions 활용** - 11시 자동 매칭 스케줄러, 포인트 자동 계산
2. **카카오톡/이메일 알림** - Supabase Edge Functions + 외부 API 연동
3. **네트워크 시각화** - D3.js로 관계도 표시
4. **AI 매칭 추천** - 교류가 적은 조합 우선 매칭
5. **모바일 앱** - React Native + Supabase 연동
6. **PWA 지원** - 오프라인 캐싱, 푸시 알림

---

## 13. 다음 단계

이 계획서 검토 후:
1. 계획 승인/수정 요청
2. 승인 시 Phase 1부터 순차 개발 시작
3. 각 Phase 완료 시 중간 확인

---

**작성일:** 2025년 1월 17일
**버전:** 1.1 (Supabase 백엔드 추가)
